<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Musrenbang 2027</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; margin: 0; display: flex; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: #1e88e5; color: white; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .sidebar-logo { text-align: center; margin-bottom: 30px; }
        .logo-img { width: 70px; margin-bottom: 10px; }
        .sidebar-nav a { display: block; color: white; text-decoration: none; padding: 12px; margin: 5px 0; border-radius: 5px; transition: 0.3s; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background: rgba(255,255,255,0.2); }
        .btn-logout { background: #d32f2f; color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 50px; }

        /* Main Content */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; display: flex; flex-direction: column; justify-content: center; }
        
        /* Table Box */
        .table-box { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { padding: 10px; border: 1px solid #eee; text-align: center; }
        th { background: #f8f9fa; font-weight: bold; }
        .text-left { text-align: left; padding-left: 15px; }

        canvas { max-width: 100%; max-height: 250px; margin: auto; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-logo">
        <img src="logo.png" class="logo-img" alt="Logo">
        <h3>ADMIN PANEL</h3>
        <p>Kecamatan Makale</p>
    </div>
    <div class="sidebar-nav">
        <a href="#" class="active">üè† Dashboard</a>
        <a href="rekap_usulan.html">üìã Rekap Usulan</a>
    </div>
    <button class="btn-logout" onclick="location.href='index.html'">LOGOUT</button>
</div>

<div class="main-content">
    <h1>Dashboard Monitoring T.A. 2027</h1>

    <div class="stats-grid">
        <div class="stat-card">
            <p>Total Usulan</p>
            <h2 id="totalUsulan" style="font-size: 48px; color: #1e88e5;">0</h2>
            <p>Usulan Masuk</p>
        </div>
        <div class="stat-card">
            <p>Statistik Per Bidang</p>
            <canvas id="bidangChart"></canvas>
        </div>
    </div>

    <div class="table-box">
        <h3>Rekapitulasi Per Kelurahan / Lembang</h3>
        <table>
            <thead>
                <tr>
                    <th rowspan="2" width="5%">No.</th>
                    <th rowspan="2">Kelurahan / Lembang</th>
                    <th rowspan="2" width="15%">Total Usulan</th>
                    <th colspan="3">Per Bidang</th>
                </tr>
                <tr>
                    <th width="15%">Sarana Prasarana</th>
                    <th width="15%">Sosial Budaya</th>
                    <th width="15%">Ekonomi</th>
                </tr>
            </thead>
            <tbody id="tabelRekap">
                <tr><td colspan="6">Memuat data...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby7nH89Rnil0q0bz0e50hFoVK7C0qRdxAOsYWRQQygY29S29L6ysavup2K2rY8_TXQ/exec"; // Ganti dengan URL Anda
    const listKelurahan = [
        "Kelurahan Ariang", "Kelurahan Batupapan", "Kelurahan Bombongan", "Kelurahan Botang", 
        "Kelurahan Buntu Burake", "Kelurahan Kamali Pentalluan", "Kelurahan Lamunan", 
        "Kelurahan Lapandan", "Lembang Lea", "Kelurahan Manggau", "Kelurahan Pantan", 
        "Kelurahan Rante", "Kelurahan Tampo Makale", "Kelurahan Tarongko", "Kelurahan Tondon Mamullu"
    ];

    let bidangChart;

    async function fetchData() {
        try {
            const response = await fetch(SCRIPT_URL + "?action=read");
            const result = await response.json();
            const data = result.data;

            let html = "";
            let counts = { sarpras: 0, sosbud: 0, ekonomi: 0 };

            listKelurahan.forEach((kel, index) => {
                const filtered = data.filter(d => d.kelurahan === kel);
                const s = filtered.filter(d => d.bidang.includes("Sarana")).length;
                const sb = filtered.filter(d => d.bidang.includes("Sosial")).length;
                const e = filtered.filter(d => d.bidang.includes("Ekonomi")).length;
                
                counts.sarpras += s;
                counts.sosbud += sb;
                counts.ekonomi += e;

                html += `<tr>
                    <td>${index + 1}</td>
                    <td class="text-left">${kel}</td>
                    <td><b>${filtered.length}</b></td>
                    <td>${s}</td>
                    <td>${sb}</td>
                    <td>${e}</td>
                </tr>`;
            });

            document.getElementById("tabelRekap").innerHTML = html;
            document.getElementById("totalUsulan").innerText = data.length;
            
            updateChart(counts);
        } catch (error) {
            console.error(error);
            document.getElementById("tabelRekap").innerHTML = "<tr><td colspan='6'>Gagal memuat data.</td></tr>";
        }
    }

    function updateChart(counts) {
        const ctx = document.getElementById('bidangChart').getContext('2d');
        if (bidangChart) bidangChart.destroy();

        bidangChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Sarpras', 'Sosbud', 'Ekonomi'],
                datasets: [{
                    data: [counts.sarpras, counts.sosbud, counts.ekonomi],
                    backgroundColor: ['#1e88e5', '#e53935', '#ffb300']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'right' } }
            }
        });
    }

    window.onload = fetchData;
</script>
</body>
</html>
