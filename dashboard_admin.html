<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Admin Musrenbang Makale</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f4f7f6; display: flex; }
        
        /* SIDEBAR */
        .sidebar { width: 250px; background: #1a5bb8; height: 100vh; position: fixed; color: #fff; padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; }
        .logo { width: 80px; height: auto; margin-bottom: 10px; }
        .btn-nav, .btn-logout { width: 100%; padding: 12px; border: none; border-radius: 5px; font-weight: bold; margin-top: 10px; cursor: pointer; transition: 0.3s; }
        .btn-nav { background: #1a5bb8; color: #fff; text-align: left; text-decoration: none; display: block; }
        .btn-nav:hover, .btn-nav.active { background: rgba(255,255,255,0.2); }
        .btn-logout { background: #c0392b; color: #fff; margin-top: auto; }

        /* MAIN CONTENT */
        .main-content { margin-left: 270px; padding: 30px; width: calc(100% - 270px); }
        
        /* GRID STATISTIK - DIPERBESAR */
        .grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .card { background: #fff; padding: 30px 15px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,.08); text-align: center; border-bottom: 5px solid #ddd; }
        .stat-value { font-size: 42px; font-weight: bold; margin: 10px 0; }
        
        /* Warna Identitas Bidang */
        .card.total { border-color: #1a5bb8; } .card.total .stat-value { color: #1a5bb8; }
        .card.sarpras { border-color: #3498db; } .card.sarpras .stat-value { color: #3498db; }
        .card.sosbud { border-color: #9b59b6; } .card.sosbud .stat-value { color: #9b59b6; }
        .card.ekonomi { border-color: #27ae60; } .card.ekonomi .stat-value { color: #27ae60; }

        /* TABEL REKAPITULASI - RINCIAN BIDANG */
        .rekap-kelurahan { background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,.08); }
        .rekap-kelurahan h3 { margin-top: 0; color: #333; border-left: 5px solid #1a5bb8; padding-left: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f8f9fa; color: #444; padding: 15px 10px; font-size: 13px; border: 1px solid #eee; text-align: center; }
        td { padding: 12px 10px; border: 1px solid #eee; text-align: center; font-size: 14px; color: #555; }
        .text-left { text-align: left; font-weight: 500; color: #333; }
        .total-bold { font-weight: bold; color: #1a5bb8; background: #f0f4f8; }
        tr:hover { background: #f9f9f9; }
    </style>
</head>
<body>

<div class="sidebar">
    <img src="./logo-makale.png" alt="Logo" class="logo">
    <h3>ADMIN PANEL</h3>
    <p style="font-size: 12px; opacity: 0.8;">Kecamatan Makale</p>
    <hr style="width:100%; opacity: 0.2; margin: 20px 0;">
    <a href="dashboard_admin.html" class="btn-nav active">üè† Dashboard</a>
    <a href="rekap_admin.html" class="btn-nav">üìä Rekap Usulan</a>
    <button class="btn-logout" onclick="localStorage.clear();location.href='index.html'">LOGOUT</button>
</div>

<div class="main-content">
    <h1>Dashboard Monitoring T.A. 2027</h1>

    <div class="grid-container">
        <div class="card total">
            <h4>Total Usulan</h4>
            <div class="stat-value" id="totalUsulan">0</div>
            <p style="color:#666">Seluruh Bidang</p>
        </div>
        <div class="card sarpras">
            <h4>Bidang Sarpras</h4>
            <div class="stat-value" id="valSarpras">0</div>
            <p style="color:#666">Infrastruktur</p>
        </div>
        <div class="card sosbud">
            <h4>Bidang Sosbud</h4>
            <div class="stat-value" id="valSosbud">0</div>
            <p style="color:#666">Sosial Budaya</p>
        </div>
        <div class="card ekonomi">
            <h4>Bidang Ekonomi</h4>
            <div class="stat-value" id="valEkonomi">0</div>
            <p style="color:#666">Pemberdayaan</p>
        </div>
    </div>

    <div class="rekap-kelurahan">
        <h3>Rekapitulasi Usulan Per Kelurahan / Lembang</h3>
        <table>
            <thead>
                <tr>
                    <th class="text-left" rowspan="2">Kelurahan / Lembang</th>
                    <th colspan="3">Rincian Per Bidang</th>
                    <th rowspan="2" style="background:#eef2f7">Total Usulan</th>
                </tr>
                <tr>
                    <th style="color: #3498db;">Sarpras</th>
                    <th style="color: #9b59b6;">Sosbud</th>
                    <th style="color: #27ae60;">Ekonomi</th>
                </tr>
            </thead>
            <tbody id="bodyKelurahan">
                </tbody>
        </table>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    const URL = "https://script.google.com/macros/s/AKfycbyh4Q6HyTlG3fAA8FOd3fV1tJrfbb4IGshQ4wAWzHyoGsAWpeg7Gpur7FmxUp_G65q8/exec";
    
    // Daftar 15 Kelurahan/Lembang Makale
    const daftarKelurahan = [
        "Kelurahan Ariang", "Kelurahan Batupapan", "Kelurahan Bombongan", "Kelurahan Botang",
        "Kelurahan Buntu Burake", "Kelurahan Kamali Pentalluan", "Kelurahan Lamunan",
        "Kelurahan Lapandan", "Lembang Lea", "Kelurahan Manggau", "Kelurahan Pantan",
        "Kelurahan Rante", "Kelurahan Tampo Makale", "Kelurahan Tarongko", "Kelurahan Tondon Mamullu"
    ];

    try {
        const res = await fetch(URL);
        const result = await res.json();
        const rawData = result.data || result; 

        let stats = { total: 0, sarpras: 0, sosbud: 0, ekonomi: 0 };
        const rekap = {};

        // Inisialisasi daftar kelurahan agar tetap muncul meski data masih 0
        daftarKelurahan.forEach(name => {
            rekap[name] = { sarpras: 0, sosbud: 0, ekonomi: 0, total: 0 };
        });

        rawData.forEach(d => {
            const b = (d.bidang || "").toLowerCase();
            const n = d.kelurahan || "";

            if (rekap[n]) {
                stats.total++;
                rekap[n].total++;
                if (b.includes("sarana") || b.includes("sarpras")) { stats.sarpras++; rekap[n].sarpras++; }
                else if (b.includes("sosial") || b.includes("sosbud")) { stats.sosbud++; rekap[n].sosbud++; }
                else if (b.includes("ekonomi")) { stats.ekonomi++; rekap[n].ekonomi++; }
            }
        });

        // Update Kotak Statistik Atas
        document.getElementById("totalUsulan").innerText = stats.total;
        document.getElementById("valSarpras").innerText = stats.sarpras;
        document.getElementById("valSosbud").innerText = stats.sosbud;
        document.getElementById("valEkonomi").innerText = stats.ekonomi;

        // Render Tabel
        const bodyKel = document.getElementById("bodyKelurahan");
        bodyKel.innerHTML = daftarKelurahan.map(name => `
            <tr>
                <td class="text-left">${name}</td>
                <td>${rekap[name].sarpras}</td>
                <td>${rekap[name].sosbud}</td>
                <td>${rekap[name].ekonomi}</td>
                <td class="total-bold">${rekap[name].total}</td>
            </tr>
        `).join("");

    } catch (e) {
        console.error("Fetch error:", e);
        document.getElementById("bodyKelurahan").innerHTML = '<tr><td colspan="5" style="text-align:center; color:red; padding:20px;">Gagal memuat data. Periksa koneksi internet atau URL API.</td></tr>';
    }
});
</script>
</body>
</html>
