<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Musrenbang 2027</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; margin: 0; display: flex; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: #1e88e5; color: white; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .sidebar-logo { text-align: center; margin-bottom: 30px; }
        .sidebar-logo img { width: 80px; }
        .sidebar-nav a { display: block; color: white; text-decoration: none; padding: 12px; margin: 5px 0; border-radius: 5px; }
        .sidebar-nav a.active { background: rgba(255,255,255,0.2); }

        /* Main Content */
        .main-content { flex: 1; padding: 30px; }
        .header { margin-bottom: 30px; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; }
        .stat-card h2 { font-size: 32px; margin: 10px 0; color: #1e88e5; }

        /* Tabel */
        .table-box { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { padding: 12px; border: 1px solid #eee; text-align: center; }
        th { background: #f8f9fa; color: #333; }
        .text-left { text-align: left; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-logo">
        <img src="logo.png" alt="Logo">
        <h3>ADMIN PANEL</h3>
        <p>Kecamatan Makale</p>
    </div>
    <div class="sidebar-nav">
        <a href="#" class="active">üè† Dashboard</a>
    </div>
</div>

<div class="main-content">
    <div class="header">
        <h1>Dashboard Monitoring T.A. 2027</h1>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <p>Total Usulan</p>
            <h2 id="totalUsulanDisplay">34</h2>
            <p>Usulan Masuk</p>
        </div>
        <div class="stat-card">
            <p>Statistik Per Bidang</p>
            <div id="chartPlaceholder" style="height: 100px; display: flex; align-items: center; justify-content: center; color: #ccc;">
                [Grafik Pie Chart Tetap Tampil Di Sini]
            </div>
        </div>
    </div>

    <div class="table-box">
        <h3>Rekapitulasi Per Kelurahan / Lembang</h3>
        <table>
            <thead>
                <tr>
                    <th rowspan="2" width="5%">No.</th>
                    <th rowspan="2" width="25%">Kelurahan / Lembang</th>
                    <th rowspan="2" width="10%">Total Usulan</th>
                    <th colspan="3">Per Bidang</th>
                </tr>
                <tr>
                    <th width="20%">Sarana Prasarana</th>
                    <th width="20%">Sosial Budaya</th>
                    <th width="20%">Ekonomi</th>
                </tr>
            </thead>
            <tbody id="tabelRekapBody">
                <tr><td colspan="6" align="center">Memuat data dari Google Sheet...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby7nH89Rnil0q0bz0e50hFoVK7C0qRdxAOsYWRQQygY29S29L6ysavup2K2rY8_TXQ/exec"; // Masukkan URL Web App Script Anda
    const listKelurahan = [
        "Kelurahan Ariang", "Kelurahan Batupapan", "Kelurahan Bombongan", "Kelurahan Botang", 
        "Kelurahan Buntu Burake", "Kelurahan Kamali Pentalluan", "Kelurahan Lamunan", 
        "Kelurahan Lapandan", "Lembang Lea", "Kelurahan Manggau", "Kelurahan Pantan", 
        "Kelurahan Rante", "Kelurahan Tampo Makale", "Kelurahan Tarongko", "Kelurahan Tondon Mamullu"
    ];

    async function loadRekap() {
        try {
            const res = await fetch(SCRIPT_URL + "?action=read");
            const json = await res.json();
            const data = json.data;

            let html = "";
            let totalSemua = 0;

            listKelurahan.forEach((kel, index) => {
                const usulanKel = data.filter(d => d.kelurahan === kel);
                const sarpras = usulanKel.filter(d => d.bidang.includes("Sarana")).length;
                const sosbud = usulanKel.filter(d => d.bidang.includes("Sosial")).length;
                const ekonomi = usulanKel.filter(d => d.bidang.includes("Ekonomi")).length;
                const total = usulanKel.length;
                totalSemua += total;

                html += `<tr>
                    <td>${index + 1}</td>
                    <td class="text-left">${kel}</td>
                    <td><b>${total}</b></td>
                    <td>${sarpras}</td>
                    <td>${sosbud}</td>
                    <td>${ekonomi}</td>
                </tr>`;
            });

            document.getElementById("tabelRekapBody").innerHTML = html;
            document.getElementById("totalUsulanDisplay").innerText = totalSemua;
        } catch (e) {
            document.getElementById("tabelRekapBody").innerHTML = "<tr><td colspan='6' style='color:red'>Gagal memuat data. Periksa URL Script Anda.</td></tr>";
        }
    }

    window.onload = loadRekap;
</script>
</body>
</html>
