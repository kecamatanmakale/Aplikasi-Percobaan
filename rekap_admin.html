<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Rekap Usulan Musrenbang - Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: #f4f6f9;
}

header {
    background: #1a5bb8;
    color: white;
    padding: 15px 25px;
    font-size: 20px;
    font-weight: bold;
}

.container {
    padding: 20px;
}

.card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.top-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}

input, select {
    padding: 8px 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

th {
    background: #1a5bb8;
    color: white;
    padding: 10px;
    font-size: 14px;
}

td {
    padding: 9px;
    border-bottom: 1px solid #ddd;
    font-size: 13px;
}

tr:hover {
    background: #f1f6ff;
}

.footer {
    margin-top: 15px;
    font-size: 13px;
    color: #555;
}

.loading {
    text-align: center;
    padding: 30px;
    font-weight: bold;
}
</style>
</head>

<body>

<header>
    REKAP USULAN MUSRENBANG â€“ ADMIN KELURAHAN
</header>

<div class="container">
    <div class="card">

        <div class="top-bar">
            <input type="text" id="search" placeholder="ðŸ” Cari data...">
            <select id="filterBidang">
                <option value="">Semua Bidang</option>
            </select>
        </div>

        <div id="loading" class="loading">Memuat data...</div>

        <table id="tabel" style="display:none">
            <thead>
                <tr id="thead"></tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>

        <div class="footer" id="totalData"></div>

    </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzIzL_RN4G792x99gfTRwDiNOnqBj_MMbG6fhA3w791BSOCjHxAuxFT5rLGgdvBRuf/exec";

let allData = [];

fetch(API_URL)
.then(res => res.json())
.then(res => {
    if (res.status !== "success") {
        alert("Gagal memuat data");
        return;
    }

    allData = res.data;
    buildTable(allData);
    buildFilter(allData);
})
.catch(err => {
    alert("Koneksi gagal");
    console.error(err);
});

function buildTable(data) {
    const thead = document.getElementById("thead");
    const tbody = document.getElementById("tbody");

    thead.innerHTML = "";
    tbody.innerHTML = "";

    if (data.length === 0) return;

    // header otomatis
    Object.keys(data[0]).forEach(key => {
        const th = document.createElement("th");
        th.textContent = key.toUpperCase();
        thead.appendChild(th);
    });

    data.forEach(row => {
        const tr = document.createElement("tr");
        Object.values(row).forEach(val => {
            const td = document.createElement("td");
            td.textContent = val;
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });

    document.getElementById("loading").style.display = "none";
    document.getElementById("tabel").style.display = "table";
    document.getElementById("totalData").innerText =
        "Total Data: " + data.length;
}

function buildFilter(data) {
    const filter = document.getElementById("filterBidang");
    const bidangSet = new Set();

    data.forEach(d => {
        if (d.bidang) bidangSet.add(d.bidang);
    });

    bidangSet.forEach(b => {
        const opt = document.createElement("option");
        opt.value = b;
        opt.textContent = b;
        filter.appendChild(opt);
    });
}

// SEARCH
document.getElementById("search").addEventListener("keyup", function () {
    const keyword = this.value.toLowerCase();

    const filtered = allData.filter(row =>
        Object.values(row).join(" ").toLowerCase().includes(keyword)
    );

    buildTable(filtered);
});

// FILTER BIDANG
document.getElementById("filterBidang").addEventListener("change", function () {
    const val = this.value;

    let filtered = allData;

    if (val !== "") {
        filtered = allData.filter(d => d.bidang == val);
    }

    buildTable(filtered);
});
</script>

</body>
</html>
