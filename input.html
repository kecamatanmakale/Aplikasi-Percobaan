<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Usulan Musrenbang</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .no-print { margin-bottom: 20px; }
        
        /* Gaya Tabel */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #bdc3c7; padding: 12px; text-align: left; }
        th { background-color: #34495e; color: white; }
        .tr-total { background-color: #f2f2f2; font-weight: bold; }
        
        /* Gaya Tanda Tangan */
        .signature-container { margin-top: 50px; float: right; text-align: center; width: 300px; }
        .signature-space { height: 80px; }

        /* Media Query Khusus Cetak */
        @media print {
            .no-print, .btn-aksi { display: none !important; }
            body { margin: 0; }
            table { border: 1px solid black; }
            th { background-color: #34495e !important; -webkit-print-color-adjust: exact; }
            @page { size: A4 landscape; margin: 1cm; }
        }

        .btn-print { background-color: #27ae60; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px; }
        .btn-print:hover { background-color: #2ecc71; }
    </style>
</head>
<body>

    <div class="no-print">
        <h2>Input Usulan Musrenbang</h2>
        <p><i>Halaman ini akan otomatis menyesuaikan jabatan berdasarkan login Kelurahan.</i></p>
        <button class="btn-print" onclick="window.print()">Cetak Laporan (PDF)</button>
        <hr>
    </div>

    <h3 style="text-align: center;">DAFTAR USULAN KEGIATAN</h3>

    <table>
        <thead>
            <tr>
                <th>Kegiatan</th>
                <th>Bidang</th>
                <th>Lokasi</th>
                <th>Volume</th>
                <th>Anggaran (Rp)</th>
                <th class="btn-aksi">Aksi</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
        <tfoot>
            <tr class="tr-total">
                <td colspan="4" style="text-align: right;">TOTAL ANGGARAN:</td>
                <td id="total-anggaran">0</td>
                <td class="btn-aksi"></td>
            </tr>
        </tfoot>
    </table>

    <div class="signature-container">
        <p>Tampo Makale, <span id="tgl-sekarang"></span> 2026</p>
        <p><b id="jabatan-display">Lurah Tampo Makale</b></p>
        <div class="signature-space"></div>
        <p><u><b id="nama-pejabat">MARTA PATANDUK, SE</b></u></p>
        <p>NIP. 196806171993032009</p>
    </div>

    <script>
        // 1. DATA SIMULASI (Sama seperti di gambar Anda)
        const dataUsulan = [
            {
                kegiatan: "Diversifikasi Tanaman Jagung dan Kacang Tanah",
                bidang: undefined, // Meniru error di gambar
                lokasi: "KWT Kayoko, Kelompok Tani Bina Akrab, Kelompok Tani Sanginaa",
                volume: "4 Kelompok",
                anggaran: 40000000
            },
            {
                kegiatan: "Rekonstruksi Jalan Kabupaten",
                bidang: "Infrastruktur", 
                lokasi: "Lingkungan Kayoko' Parada - Kel. Tampo Makale",
                volume: "260 M",
                anggaran: 250000000
            }
        ];

        // 2. SIMULASI LOGIN USERNAME
        const username = "Kelurahan Tampo Makale"; 

        function renderTable() {
            const tbody = document.getElementById('table-body');
            let total = 0;

            tbody.innerHTML = dataUsulan.map(item => {
                total += item.anggaran;
                
                // MENGATASI UNDEFINED: Jika bidang kosong, tampilkan "-"
                const bidangFix = item.bidang || "-";
                
                // FORMAT RUPIAH: Menggunakan toLocaleString
                const anggaranFix = item.anggaran.toLocaleString('id-ID');

                return `
                    <tr>
                        <td>${item.kegiatan}</td>
                        <td>${bidangFix}</td>
                        <td>${item.lokasi}</td>
                        <td>${item.volume}</td>
                        <td>${anggaranFix}</td>
                        <td class="btn-aksi">
                            <button style="background:orange; color:white; border:none; padding:5px;">✎</button>
                            <button style="background:red; color:white; border:none; padding:5px;">✘</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('total-anggaran').innerText = "Rp " + total.toLocaleString('id-ID');
        }

        function aturJabatan() {
            const jabatanDisplay = document.getElementById('jabatan-display');
            const tglDisplay = document.getElementById('tgl-sekarang');

            // Logika jabatan Plt.
            if (username === "Kelurahan Tampo Makale" || username === "Kelurahan Buntu Burake") {
                jabatanDisplay.innerText = "Plt. " + username;
            } else {
                jabatanDisplay.innerText = username;
            }

            // Isi tanggal otomatis (Opsional)
            const d = new Date();
            const tgl = d.getDate();
            const bulan = d.toLocaleString('id-ID', { month: 'long' });
            tglDisplay.innerText = `${tgl} ${bulan}`;
        }

        // Jalankan semua fungsi saat halaman dibuka
        window.onload = function() {
            renderTable();
            aturJabatan();
        };
    </script>

</body>
</html>
