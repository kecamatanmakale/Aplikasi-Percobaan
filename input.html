<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Usulan Musrenbang</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 30px; background-color: #f4f7f6; }
        
        /* Bar Navigasi Atas */
        .navbar-tools { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 20px; 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }

        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-decoration: none; display: inline-block; }
        .btn-back { background-color: #34495e; color: white; }
        .btn-excel { background-color: #1f7244; color: white; margin-right: 5px; }
        .btn-print { background-color: #2980b9; color: white; }
        .btn-submit { background-color: #27ae60; color: white; width: 100%; padding: 12px; margin-bottom: 20px; font-size: 16px; }

        /* Tabel Styles */
        table { width: 100%; border-collapse: collapse; background: white; margin-bottom: 20px; }
        th { background-color: #34495e; color: white; padding: 12px; border: 1px solid #2c3e50; }
        td { padding: 12px; border: 1px solid #ddd; vertical-align: top; }
        .total-row { background-color: #ecf0f1; font-weight: bold; }

        /* Area Tanda Tangan */
        .footer-container { margin-top: 50px; display: flex; justify-content: flex-end; }
        .signature-box { text-align: center; width: 350px; }
        .sig-space { height: 70px; }

        /* Pengaturan Cetak (PDF) */
        @media print {
            .navbar-tools, .btn-submit, .aksi-col, .btn-edit-del { display: none !important; }
            body { background: white; margin: 0; }
            .signature-box { width: 250px; }
            @page { size: landscape; margin: 1.5cm; }
            table { width: 100%; border: 1px solid black; }
            th { background-color: #34495e !important; color: white !important; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <div class="navbar-tools">
        <button class="btn btn-back" onclick="window.location.href='dashboard.html'">← Kembali ke Dashboard</button>
        <div>
            <button class="btn btn-excel" onclick="exportKeExcel()">Export Excel</button>
            <button class="btn btn-print" onclick="window.print()">Print PDF</button>
        </div>
    </div>

    <button class="btn btn-submit">Kirim Usulan</button>

    <h3>Daftar Usulan :</h3>

    <table id="tabel-data">
        <thead>
            <tr>
                <th>Kegiatan</th>
                <th>Bidang</th>
                <th>Lokasi</th>
                <th>Volume</th>
                <th>Anggaran (Rp)</th>
                <th>OPD</th>
                <th>Keterangan</th>
                <th class="aksi-col">Aksi</th>
            </tr>
        </thead>
        <tbody id="content-tabel">
            </tbody>
        <tfoot>
            <tr class="total-row">
                <td colspan="4" style="text-align: right;">TOTAL ANGGARAN:</td>
                <td id="total-val" colspan="4">Rp 0</td>
            </tr>
        </tfoot>
    </table>

    <div class="footer-container">
        <div class="signature-box">
            <p>Tampo Makale, .................... 2026</p>
            <p><b id="txt-jabatan">Lurah Tampo Makale</b></p>
            <div class="sig-space"></div>
            <p><u><b id="txt-nama">MARTA PATANDUK, SE</b></u></p>
            <p>NIP. 196806171993032009</p>
        </div>
    </div>

    <script>
        // Simulasi data dari gambar Anda
        const rawData = [
            { keg: "Diversifikasi Tanaman Jagung dan Kacang Tanah", bid: undefined, lok: "KWT Kayoko, Kelompok Tani Bina Akrab", vol: "4 Kelompok", ang: 40000000, opd: "DPKPP", ket: "Pengadaan Benih..." },
            { keg: "Rekonstruksi Jalan Kabupaten", bid: undefined, lok: "Lingkungan Kayoko' Parada", vol: "260 M", ang: 250000000, opd: "DPUTR", ket: "Lanjutan Rabat Beton..." }
        ];

        // KONFIGURASI USERNAME
        const currentUsername = "Kelurahan Tampo Makale"; 

        function initApp() {
            // 1. Logika Perubahan Jabatan "Plt. Lurah"
            const displayJabatan = document.getElementById('txt-jabatan');
            if (currentUsername === "Kelurahan Tampo Makale" || currentUsername === "Kelurahan Buntu Burake") {
                // Mengubah "Kelurahan Tampo Makale" menjadi "Plt. Lurah Tampo Makale"
                let namaKel = currentUsername.replace("Kelurahan ", "");
                displayJabatan.innerText = "Plt. Lurah " + namaKel;
            } else {
                displayJabatan.innerText = "Lurah " + currentUsername.replace("Kelurahan ", "");
            }

            // 2. Render Tabel & Perbaikan "undefined"
            const tbody = document.getElementById('content-tabel');
            let total = 0;

            tbody.innerHTML = rawData.map(item => {
                total += item.ang;
                return `
                    <tr>
                        <td><b>${item.keg}</b></td>
                        <td>${item.bid || "-"}</td> 
                        <td>${item.lok}</td>
                        <td>${item.vol}</td>
                        <td>${item.ang.toLocaleString('id-ID')}</td>
                        <td>${item.opd}</td>
                        <td>${item.ket}</td>
                        <td class="aksi-col">
                            <button class="btn-edit-del" style="background:orange; color:white; border:none; margin-bottom:2px;">✎</button><br>
                            <button class="btn-edit-del" style="background:red; color:white; border:none;">✘</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('total-val').innerText = "Rp " + total.toLocaleString('id-ID');
        }

        // Fungsi Export ke Excel
        function exportKeExcel() {
            const table = document.getElementById("tabel-data");
            const workbook = XLSX.utils.table_to_book(table, {sheet: "Laporan Musrenbang"});
            XLSX.writeFile(workbook, "Laporan_Usulan_2026.xlsx");
        }

        window.onload = initApp;
    </script>
</body>
</html>
