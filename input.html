<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Usulan Musrenbang</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --primary-green: #2d8a57; }
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .header-section { background: var(--primary-green); color: white; padding: 2rem; border-radius: 0 0 20px 20px; margin-bottom: 20px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn-kirim { background: var(--primary-green); color: white; border: none; padding: 10px; font-weight: 600; transition: 0.3s; }
        .btn-kirim:hover { background: #236d45; color: white; transform: translateY(-2px); }
    </style>
</head>
<body>

<div class="header-section text-center">
    <h2>Form Usulan Musrenbang</h2>
    <p>Kelurahan Kamali Pentalluan</p>
</div>

<div class="container mb-5">
    <div class="card mb-4">
        <div class="card-body">
            <form id="formUsulan">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Bidang Program</label>
                        <select id="bidang" class="form-select" required>
                            <option value="">-- Pilih Bidang --</option>
                            <option value="Infrastruktur">Infrastruktur</option>
                            <option value="Ekonomi">Ekonomi</option>
                            <option value="Sosial Budaya">Sosial Budaya</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nama Kegiatan</label>
                        <input type="text" id="kegiatan" class="form-control" required placeholder="Misal: Perbaikan Drainase">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Lokasi</label>
                        <input type="text" id="lokasi" class="form-control" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Volume</label>
                        <input type="text" id="volume" class="form-control" required placeholder="Misal: 200 Meter">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Anggaran (Rp)</label>
                        <input type="number" id="anggaran" class="form-control" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">OPD Tujuan</label>
                    <select id="opd" class="form-select" required>
                        <option value="">-- Pilih OPD --</option>
                        <option value="Dinas Pekerjaan Umum">Dinas Pekerjaan Umum</option>
                        <option value="Dinas Perkimtan">Dinas Perkimtan</option>
                        <option value="Dinas Pertanian">Dinas Pertanian</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Keterangan Tambahan</label>
                    <textarea id="keterangan" class="form-control" rows="2"></textarea>
                </div>

                <button type="button" onclick="kirimData()" id="btnSubmit" class="btn btn-kirim w-100">KIRIM USULAN</button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-white font-weight-bold">Daftar Usulan Anda (Lokal)</div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Kegiatan</th>
                            <th>Lokasi</th>
                            <th>Anggaran</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="tabelPreview"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxDoPzmNecnWaSIyYzpcejzdIx-EKqnXLbENe9lziW0AbcFAKePouGewOTNmtfasrSpVA/exec";

    function renderTable() {
        const data = JSON.parse(localStorage.getItem("usulan_musrenbang")) || [];
        const tbody = document.getElementById("tabelPreview");
        tbody.innerHTML = data.map(item => `
            <tr>
                <td>${item.kegiatan}</td>
                <td>${item.lokasi}</td>
                <td>Rp ${parseInt(item.anggaran).toLocaleString()}</td>
                <td><span class="badge bg-success">Terkirim</span></td>
            </tr>
        `).join('');
    }

    async function kirimData() {
        const form = document.getElementById("formUsulan");
        if(!form.checkValidity()) return alert("Mohon lengkapi semua kolom!");

        const btn = document.getElementById("btnSubmit");
        btn.disabled = true;
        btn.innerText = "Memproses...";

        const payload = {
            kelurahan: "Kamali Pentalluan",
            bidang: document.getElementById("bidang").value,
            kegiatan: document.getElementById("kegiatan").value,
            lokasi: document.getElementById("lokasi").value,
            volume: document.getElementById("volume").value,
            anggaran: document.getElementById("anggaran").value,
            opd: document.getElementById("opd").value,
            keterangan: document.getElementById("keterangan").value
        };

        try {
            // Simpan ke Google Sheets
            await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify(payload)
            });

            // Simpan ke LocalStorage
            let storage = JSON.parse(localStorage.getItem("usulan_musrenbang")) || [];
            storage.push(payload);
            localStorage.setItem("usulan_musrenbang", JSON.stringify(storage));

            alert("Usulan berhasil disimpan!");
            form.reset();
            renderTable();
        } catch (e) {
            alert("Terjadi kesalahan sistem.");
        } finally {
            btn.disabled = false;
            btn.innerText = "KIRIM USULAN";
        }
    }

    window.onload = renderTable;
</script>
</body>
</html>